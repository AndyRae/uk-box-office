{% extends 'base.html' %}

{% block title %} {{ time }} {% endblock %}

{% block schema %}
	{
		"@context": "https://schema.org/",
		"@graph":
			[{
			"@type": "Organization",
			"name" : "UK Box Office Data",
			"url" : "https://boxofficedata.co.uk",
			"logo": {
				"@type": "ImageObject",
				"url": "https://boxofficedata.co.uk/static/icons/icon-hires.png"
				}
		},
			{
			"@context":"https://schema.org/",
			"@type":"Dataset",
			"name":"{{ time }} Box Office Data",
			"description":"Weekly UK Cinema Box Office revenue data for time period: {{ time }}.",
			"url":"https://boxofficedata.co.uk{{ url_for(request.endpoint, **request.view_args) }}",
			"isBasedOn":"https://www.bfi.org.uk/industry-data-insights/weekend-box-office-figures",
			"keywords":[
				"BOX OFFICE DATA > CINEMA > {{ time }}"
			],
			"license" : "https://creativecommons.org/licenses/by-sa/4.0/",
			"isAccessibleForFree" : true,
			"creator":{
				"@type":"Organization",
				"url": "https://boxofficedata.co.uk",
				"name":"Box Office Data UK",
				"contactPoint":{
					"@type":"ContactPoint",
					"contactType": "customer service",
					"email":"hello@boxofficedata.co.uk"
				}
			},
			"funder":{
			"@type": "Organization",
			"sameAs": "https://ror.org/04qg9vz18",
			"name": "British Film Institute"
			},
			"includedInDataCatalog":{
			"@type":"DataCatalog",
			"name":"Box Office Data UK"
			},
			"distribution":[
			{
				"@type":"DataDownload",
				"encodingFormat":"CSV",
				"contentUrl":"https://boxofficedata.co.uk{{ url_for(request.endpoint, **request.view_args) }}"
			}
			],
			"temporalCoverage":"{{ time }}"
			}
		]
	}
{% endblock %}

{% block header %}
<div class="uk-container">
	<ul class="uk-breadcrumb">
		<li><a href="/">Home</a></li>
		<li><a href="{{ url_for('index.time') }}">Time</a></li>
		<li aria-current="page"><span>{{ time }}</span></li>
	</ul>

	<h1>UK Box Office {{ time }}</h1>
</div>
{% endblock %}

{% block content %}

	<div class="uk-container uk-margin-medium-top">
		<div class="p-centered">

			<canvas id="myChart" class="mt-5" width="100%" height="50px"></canvas>

			<hr>

			<canvas id="barChart" class="mt-5" width="100%" height="50px"></canvas>

			<hr>
			<a class="uk-label uk-background-secondary" href="{{ url_for('index.year_detail', year=year) }}">{{ year }}</a>
			{% for j in range(1,13) %}
				<a class="uk-label uk-background-secondary" href="{{ url_for('index.month_detail', year=year, month=j) }}">{{ j|date_convert_to_month }}</a>
			{% endfor %}
		</div>

		<hr>

		<ul uk-accordion="multiple: true">
			<li>
				<a class="uk-accordion-title" href="#">Weeks</a>
				<div class="uk-accordion-content">
					<div class="uk-overflow-auto">
						<table class="uk-table uk-table-small uk-table-divider uk-table-hover uk-table-striped">
							<thead>
								<tr>
									<th>Week Ending</th>
									<th class="uk-text-center">Weekend Box Office</th>
									<th class="uk-text-center">Week Box Office</th>
									<th class="uk-text-center">Week Change</th>
									<th class="uk-text-center">Releases</th>
									<th class="uk-text-center">Cinemas</th>
								</tr>
								</thead>
								<tbody>
									{% for i in graph_data|reverse %}
										<tr>
											<td><a class="action" href="{{ url_for('index.week_detail', year=i.date.year, month=i.date.month, start_day=i.date.day) }}">
												{{ i.date|date_convert }}
											</a></td>
											<td class="uk-text-center">{{ "£{:,}".format(i.weekend_gross) }}</td>
											<td class="uk-text-center">{{ "£{:,}".format(i.week_gross) }}</td>
											{% if i.pct_change_week|round(2) > 0 %}
												<td class="uk-text-success uk-text-center">{{ i.pct_change_week|round(2) }}%</td>
											{% elif i.pct_change_week|round(2) < 0 %}
												<td class="uk-text-danger uk-text-center">{{ i.pct_change_week|round(2) }}%</td>
											{% else %}
												<td class="uk-text-center">-</td>
											{% endif %}
											<td class="uk-text-center">{{ i.id}}</td>
											<td class="uk-text-center">{{ i.number_of_cinemas}}</td>
										</tr>
									{% endfor %}
								</tbody>
						</table>
					</div>
				</div>
			</li>

			<li class="uk-open">
				<a class="uk-accordion-title" href="#">Films</a>
				<div class="uk-accordion-content">
					<div class="uk-overflow-auto">
						<table class="uk-table uk-table-small uk-table-divider uk-table-hover uk-table-striped" id="filmsTable">
							<thead>
								<tr>
									<th class="uk-text-center">Rank</th>
									<th>Film</th>
									<th class="uk-text-center">Box Office</th>
								</tr>
							</thead>
							<tbody>
								{% for i in table_data %}
									<tr>
										<td class="uk-text-center">{{ loop.index }}</td>
										<td><a class="action" href="{{ url_for('index.film', slug=i.slug) }}">{{ i.title|title }}</a></td>
										<td class="uk-text-center">{{ "£{:,}".format(i.week_gross) }}</td>
									</tr>
								{% endfor %}
							</tbody>
						</table>
					</div>
					<button type="button" onclick="exportToCSV(filmsTable)" class="uk-button uk-button-default uk-margin-small-top" uk-icon="download">
						Export (.csv)
					</button>
				</div>
			</li>
		</ul>
		<div>
			Source: <a class="action" href="https://www.bfi.org.uk/industry-data-insights/weekend-box-office-figures" target="_blank">bfi.org.uk</a>
		</div>

	</div>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js" integrity="sha512-qTXRIMyZIFb8iQcfjXWCO8+M5Tbc38Qi5WzdPOYZHIlZpzBHG3L3by84BBBOiRGiEb7KKtAOAs5qYdUiZiQNNQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.5.1/chart.min.js" integrity="sha512-Wt1bJGtlnMtGP0dqNFH1xlkLBNpEodaiQ8ZN5JLA5wpc1sUlk/O5uuOMNgvzddzkpvZ9GLyYNa8w2s7rqiTk5Q==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

	<script>
		var time_dates = []
		var week_gross = []
		'{% for i in graph_data %}'

			time_dates.push('{{ i["date"]|date_convert }}')
			week_gross.push('{{ i["week_gross"] }}')

		'{% endfor %}'

		var films = []
		var box = []
		'{% for i in table_data[:20] %}'

			films.push('{{ i["title"][:20]|title }}')
			box.push('{{ i["week_gross"] }}')

		'{% endfor %}'
	</script>

	<script src="{{ url_for('static', filename='js/time_detail.js') }}"></script>

{% endblock %}
