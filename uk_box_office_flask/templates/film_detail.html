{% extends 'base.html' %}

{% block title %}{{ data.title|title }}{% endblock %}

{% block schema %}

<script type="application/ld+json">
	{
		"@context":"https://schema.org/",
		"@type":"Dataset",
		"name":"{{ data.title }} Box Office Data",
		"description":"Weekly UK Cinema Box Office data for {{ data.title }}.",
		"url":"/",
		"isBasedOn":"https://www.bfi.org.uk/industry-data-insights/weekend-box-office-figures",
		"keywords":[
		   "BOX OFFICE DATA > CINEMA > {{ data.title }}",
		],
		"isAccessibleForFree" : true,
		"creator":{
		   "@type":"Organization",
		   "url": "https://boxofficedata.co.uk",
		   "name":"Box Office Data UK",
		   "contactPoint":{
			  "@type":"ContactPoint",
			  "contactType": "customer service",
			  "email":"hello@boxofficedata.co.uk"
		   }
		},
		"funder":{
		   "@type": "Organization",
		   "sameAs": "https://ror.org/04qg9vz18",
		   "name": "British Film Institute"
		},
		"includedInDataCatalog":{
		   "@type":"DataCatalog",
		   "name":"Box Office Data UK"
		},
		"distribution":[
		   {
			  "@type":"DataDownload",
			  "encodingFormat":"CSV",
			  "contentUrl":"https://boxofficedata.co.uk"
		   },
		],
		"temporalCoverage":"{{ data.weeks[-1].date|date_convert}}/{{ data.weeks[0].date|date_convert }}",
	}
</script>


{% endblock %}

{% block header %}
	<ul class="breadcrumb">
		<li class="breadcrumb-item">
		<a href="/">Home</a>
		</li>
		<li class="breadcrumb-item">
		<a href="{{ url_for('index.films') }}">Films</a>
		</li>
		<li class="breadcrumb-item">
		<a href="">{{ data.title|title }}</a>
		</li>
	</ul>
	<h1 class="pt-2 pb-2">{{ data.title|title }}</h1>
{% endblock %}

{% block content %}	

	<div class="container grid-lg">
		<div class="p-centered pt-2">

			<h5 class="pt-2 pb-2">Country: {{ data.country|title }}</h5>
			<h5 class="pt-2 pb-2">Distributor: <a class="action" href="{{ url_for('index.distributor', slug=data['distributor']['slug']) }}">{{ data.distributor|title }}</a></h5>			

			<canvas id="myChart" class="pt-2 pb-2" width="100%" height="50px"></canvas>

			<div class="divider pb-2 pt-2"></div>
	
		</div>

		<div class="columns">
			<div class="column col-xs-6">

				<table class="table table-striped table-hover pt-2 pb-2">
					<thead>
						<tr>
						  <th>Weeks</th>
						  <th>Date</th>
						  <th>Rank</th>
						  <th>Number of cinemas</th>
						  <th>Week Gross</th>
						  <th>Weekend Gross</th>
						  <th>Cumulative Gross</th>
						</tr>
					  </thead>
					  <tbody>
						{% for i in data.weeks %}
							<tr class="">
								<td>{{ i['weeks_on_release'] }}</td>
								<td>{{ i['date']|date_convert }}</td>
								
								<td>{{ i['rank']}}</td>
								<td>{{ i['number_of_cinemas'] }}</td>
								<td>{{ "£ {:,}".format(i['week_gross']) }}</td>
								<td>{{ "£ {:,}".format(i['weekend_gross']) }}</td> 
								<td>{{ "£ {:,}".format(i['total_gross']) }}</td> 
							</tr>
						{% endfor %}
					  </tbody>
				</table>

			</div>
		</div>
	</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.5.1/chart.min.js" integrity="sha512-Wt1bJGtlnMtGP0dqNFH1xlkLBNpEodaiQ8ZN5JLA5wpc1sUlk/O5uuOMNgvzddzkpvZ9GLyYNa8w2s7rqiTk5Q==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script>
	function graph(time_dates, week_gross, cum_gross) {
		var ctx = document.getElementById('myChart');
		var myChart = new Chart(ctx, {
			type: 'line',
			data: {
				labels: time_dates,
				datasets: [{
					label: 'Week Box Office',
					data: week_gross,
					backgroundColor: [
						'rgba(0, 0, 0, 1)',
					],
					borderColor: [
						'rgba(0, 0, 0, 1)',
					],
					pointStyle: 'line',
					tension: 0.3,
					yAxisID: 'y'
				}]
			},
			options: {
				scales: {
					y: {
						beginAtZero: true,
						ticks: {
							callback: function(value, index, values) {
								return '£ ' + value;
							}
						}
					},
				}
			}
		});
	}
	
	var time_dates = []
	var week_gross = []
	var cum_gross = []
	'{% for i in w %}'

		time_dates.push('{{ i["index"]|date_convert }}')
		week_gross.push('{{ i["week_gross"] }}')

	'{% endfor %}'

	graph(time_dates, week_gross, cum_gross)

</script>
{% endblock %}